import Image from '@/components/Image'
import ModuleInfo from '@/components/ModuleInfo'
import styles from '@/components/image.module.css'

# Levels - Auto Cover

<ModuleInfo/>

**Automatic Cover Calculator** _(Levels - Automatic Cover Calculator in
releases)_ is a submodule for [Levels](Levels). It calculates
a precise cover percentage for tokens and can display their cover value
above tokens.

Options include defeated enemies as cover but at a reduced height and
more. Preconfigured for dnd5e but works with all systems. Also adds the
ability to duck\!

## How to use

### Non DnD5e systems

If you are using a system other than DnD5e, you will need to configure the cover calculation yourself. This means configuring both the Item containing the active effects and the definitions in the module settings.
Note that systems that don't support the core Foundry active effects (such as PF2e) will only be able to use the text\chat output mode and won't be able to use the stats automation provide by the active effects.

### Quick configuration (DND5E)

<Image
  src='/images/Levels-Auto-Cover/Autocovernocover.png'
  alt='Ignore Active Effect example'
  
  
  className={styles.wikiImage}
/>

- After enabling the module import the cover item from the compendium
- In the Module Settings enable `Automatically Apply Active Effects`
- Drop some NPCs and Players onto the map
- Enter Combat
- Target a Creature

### Why is the cover calculation not working?

<Image
  src='/images/Levels-Auto-Cover/MidiQol_Settings.png'
  alt='Location of settings'
  
  
  className={styles.wikiImage}
/>

- Make sure the combat is started and that you are targeting with the
  current turn creature.
- As a GM, Targeting from a Player's token will not calculate cover to
  avoid database update concurrency issues
- Make sure there is a wall or floor that provides cover
- You can test this easly by placing a wall that completely obstructs
  vision, then, disable vision on the token (so that it can see tokens
  beyond the wall) and try targeting (you should get 3\\4 cover)

### Ignoring Cover

If you have an actor for which you wish to ignore the cover active
effect application, you can do so with an active effect on the actor or
on the specific feature, the necessary flag to ignore cover is
`flags.levelsautocover.noae` set the Mode to `Override` and Value to `1`
<Image
  src='/images/Levels-Auto-Cover/Achudbtn.png'
  alt='Ducking Button'
  
  
  className={styles.wikiImage}
/>

### Custom Configuration and other settings

The Automatic Cover Calculator can be heavly customized, head to the
module settings to see all the customization options.

All settings are described in details in the Settings hints.

#### Cover Definition

This can be defined in the settings, defaults to `25,Three Quarters Cover|50,Half Cover` but can be changed to anything you want.
Remember that the number refers to the visible percentage of the target, for example a target that is 25% visible will have Three Quarters Cover.

## Ducking

Ducking will allow tokens to duck, changing their sight elevation and
therefore being able to hide behind tables and the like.

To toggle ducking, simply click the button in the token HUD!

## Midi-qol Integration

If you are using Midi-qol it's suggested that you let it take over cover
handling, Automatic Cover Calculator will just act as a library module
handling the math. To do so, simply enable these 2 settings in the
Midi-qol configuration

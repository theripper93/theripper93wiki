import Image from '@/components/Image'
import ModuleInfo from '@/components/ModuleInfo'
import styles from '@/components/image.module.css'
import { Callout } from 'nextra-theme-docs';

# Simple Quest

<ModuleInfo/>

A simple and clean quest management interface with personal and shared notes.

## How to use

<Image
  src='/images/simple-quest/simple-quest.png'
  alt='Simple Quest Interface'
  className={styles.wikiImage}
/>

<Callout type='warning' emoji='⚠️'>
    Note that players should not have Ownership of the quests journals - if you give them ownership they will be able to edit the quests but they will also see hidden objectives.
</Callout>

### Setting up the quest log
When you first enable the module, basic journals will be created automatically.

1. Head to your Journals sidebar tab
2. Open the `Quests` folder
3. You will see your quest categories (and the `Party` journal which will be explained later)
4. You can add a Journal Page to these journals to create a new quest, any Ordered or Unordered list will be displayed as a checklist in the Simple Quest interface
5. Congratulations, you are done! Create all the quests you want and they will be displayed in the Simple Quest interface

### Using the quest log

You can open the Simple Quest interface by clicking the `Simple Quest` button in the `Notes` scene controls or with the `J` hotkey.

If you wish you can create a macro with the following code to toggle the Simple Quest interface:

```js
ui.simpleQuest.toggle()
```

### Simple Quest interface

There are 3 main areas in the Simple Quest interface:

1. Navigation bar
2. Quest list
3. Quest details

#### Navigation bar
Here you can select which tab you want to view, the main Quests tab will display your quests while the `My Notes` and `Party Journal` tabs will display your personal and shared notes respectively.
You can edit your notes by clicking the `Edit` button in the top right corner of the notes area.

#### Quest list
Here you can see all your quests, you can click on a quest to view its details and click the Arrow button to collapse or expand a category.

##### Hiding a quest
As the GM you can hide a quest from the players by clicking the `Hide` located to the Left of the quest name. Note that this button is hidden and only displays on Hover.

#### Quest details
Here you can see the details of the selected quest, you can edit the quest name and description by clicking the `Edit` button in the top right corner of the details area.
This area also includes a `Delete` and `Duplicate` buttons as well as a dropdown to move the quest to a different journal.

##### Objectives
If your quest has a checklist, you can check or uncheck items by clicking on them.

- Left click to check or uncheck an item
- Right click to check as failed

As the GM you can also hide a quest objective by clicking the `Hide` located to the Left of the checkbox. Note that this button is hidden and only displays on Hover.

### Maps Tab

<Image
  src='/images/simple-quest/simple-quest-map.png'
  alt='Simple Quest Map Tab'
  className={styles.wikiImage}
/>

Welcome to the Maps Tab! This feature is designed to enhance your navigation experience and help you keep track of important locations in a user-friendly manner. The Maps Tab provides various functionalities, making it a valuable tool for organizing, annotating, and exploring maps.

#### Basic Navigation

- **Pan the Map:**
  - Click and drag on the map to move around and explore different areas.

- **Zoom In/Out:**
  - Use the scroll wheel on your mouse to zoom in and out of the map for a more detailed or broader view.

#### Adding Markers

- **Add Marker:**
  - Right-click on the map to add a marker at the selected location.

- **Edit Marker:**
  - Right-click on an existing marker to edit its details. This feature allows you to modify the marker's name, description, or any other relevant information.

#### Interacting with Markers

- **Open Marker:**
  - Left-click on a marker to open its associated notes or quest details. This feature provides a convenient way to access additional information about specific locations.

#### Fog of War

<Callout type='warning' emoji='⚠️'>
  Simple quest utilizes a Poligonal fog of war implementation. Compared to the Scene image based one, this implementation is much more performant but comes with some limitations. Mainly Holes with holes will produce unexpected results. Try to avoid using them.
</Callout>

The Maps Tab also supports the Fog of War feature, allowing you to hide certain areas of the map from players. This feature is especially useful for revealing new areas as players explore the map.
To use the Fog of War feature, follow these steps:

- Click the `Reset fog of war` button to initialize the fog of war for the current map.
- Shift + Left-click on the map to hide areas on the map.
- Shift + Right-click on the map to reveal areas on the map.
- Use the brush size slider to adjust the size of the brush used to hide or reveal areas on the map.


#### Hotkeys

To streamline your experience, the Maps Tab supports several hotkeys for quick and efficient navigation:

- **Pan the Map:**
  - **Click + Drag:** Hold down the left mouse button and drag to pan the map.

- **Zoom In/Out:**
  - **Scroll:** Use the scroll wheel on your mouse to zoom in and out of the map.

- **Adding Markers:**
  - **Right Click:** Add a marker at the location where you right-click on the map.

- **Interacting with Markers:**
  - **Left Click:** Open a marker's notes or quest details.

  - **Right Click:** Edit an existing marker.

#### Super Resolution Maps
Even though the process requires some work, it's possible to get very high resolution maps working smoothly with the Multi Resolution Feature.

In this instance we are talking about maps that are 10000x10000 pixels or more. If you attempt to use a map of this size without the Multi Resolution Feature, you will experience a lot of lag and stuttering when moving around the map.

In order to create a Super Resolution map, follow these steps:

1. Get your source image split into a power of 2 grid (2x2, 3x3, 4x4 etc.). You can do so using image editing software or with an [online tool](https://www.imgonline.com.ua/eng/cut-photo-into-pieces.php).
2. Make sure the order of your images is left to right, top to bottom. The above online tool will do this automatically.
3. Close Simple Quest, head to the Journals Sidebar tab and open the `Maps` Journal within the `Quests` folder.
4. Create a new Journal Page of the type `text`
5. Add every image in order to the Journal Page, you can do so with the `Insert Image` button in the toolbar.
6. Save the Journal Page and close the Journal.
7. Open Simple Quest and head to the Maps tab, you should see your map there.

##### Very large maps (16k+)

For maps this large, you can take an extra step to make the experience even smoother.

After following the steps above, create a low resolution version (4K or less) of your map and set it as the first image in the Journal Page.
This image will be used when the zoom level is low and will be replaced by the high resolution version when zooming in.

If you are technical enough, you can also use this Python script to automate the process of splitting the image into a grid and creating the low resolution version.

<details>
<summary>Python script</summary>

Note that the script requires the [Pillow](https://pillow.readthedocs.io/en/stable/) library.
You can install it with:

```bash
pip install Pillow
```


```python
from PIL import Image
import os

Image.MAX_IMAGE_PIXELS = None

def split_and_resize_image(image_path, num_splits):
    original_image = Image.open(image_path)
    width, height = original_image.size
    sub_image_width = width // num_splits
    sub_image_height = height // num_splits
    output_folder = 'sub_images'
    os.makedirs(output_folder, exist_ok=True)

    shorter_side = min(width, height)
    new_width = 2048 * width // shorter_side
    new_height = 2048 * height // shorter_side
    low_resolution = original_image.resize((new_width, new_height))
    low_resolution.save(os.path.join(output_folder, 'sub_image_0.png'))

    for i in range(num_splits):
        for j in range(num_splits):
            left = j * sub_image_width
            upper = i * sub_image_height
            right = left + sub_image_width
            lower = upper + sub_image_height
            sub_image = original_image.crop((left, upper, right, lower))
            filename = f"sub_image_{i * num_splits + j + 1}.png"
            sub_image.save(os.path.join(output_folder, filename))

if __name__ == "__main__":
    image_path = input("Enter the image file name - The image should be in the same folder as this script: ")
    num_splits = int(input("Enter the number of splits (same vertically and horizontally): "))
    split_and_resize_image(image_path, num_splits)
```

</details>


### Notifications
By default, Simple Quest will send a toast notification to all users whenever a non secret quest or objective is updated. You can disable this in the module settings.

### Custom Enrichers

#### @time (Requires Simple Calendar)

Simple Quest adds a custom enricher to display time left on a journal. Simply use the time enricher as in the example:

```
@time[1430/02/05, 03:29]
@time[yyyy/mm/dd, hh:mm]
```

### Custom Callouts

<Image
  src='/images/simple-quest/simple-quest-callouts.png'
  alt='Simple Quest Callouts'
  className={styles.wikiImage}
/>

Simple quest adds CSS styles for custom callouts as shown in the image. To use a custom callout, edit the html of the journal page and add a callout as follows:

```html
<p class="notification quest">
  This is the content of the callout
</p>
```

You can replace `quest` with any of the additional callout types:

- `quest`
- `creature`
- `magic`
- `item`
- `event`
- `time`

### Custom Page Inserts

<Image
  src='/images/simple-quest/simple-quest-insert.png'
  alt='Simple Quest Insert'
  className={styles.wikiImage}
/>

Simple Quest adds custom page inserts you can add to your journals, for example to make some text contained within a Book page, a parchement note or a scroll.

To use a custom page insert, edit the html of the journal page and add a page insert as follows:

```html
<p class="parchment-note-1">
  This is the content of the page insert
</p>
```
You can also add `initial` to make the first letter of the text larger:

```html
<p class="parchment-note-1 initial">
  This is the content of the page insert
</p>
```

You can replace `parchment-note-1` with any of the additional page inserts:

- `parchment-note-1`
- `parchment-note-2`
- `parchment-note-3`
- `parchment-note-4`
- `parchment-book-1`
- `parchment-book-2`
- `parchment-scroll-1`

### 3D Portraits Integration

If you have 3D Portraits enabled, 3D Models can be rendered within Quests, to do so, follow these steps:

- Create an image element in your quest, you can use any image (for example a static image of the model)
- The size of the image will determine the 3D view port
- Click the Edit HTML button in the journal page toolbar
- Add the data-model3d attribute to the image element and set it to the path of the model

Your image element should look like this:

```html
<img data-model3d="path/to/3dModel.glb" src="path/to/static/image.png">
```